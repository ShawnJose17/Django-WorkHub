{% extends 'base.html' %}
{% block title %}My Notifications | WorkHub{% endblock %}

{% block content %}
<h2 class="page-title" style="margin-top: 30px; text-align:center;">My Notifications</h2>

<div class="job-grid" style="margin-top: 25px;">
    {% for note in notes %}
    <div class="job-card">

        <h4>{{ note.full_name }}</h4>
        <p class="company">{{ note.get_job_field_display }}</p>

        <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px;">
            <a href="{% url 'finder:view_notification' note.id %}" class="btn-secondary">View</a>
            <a href="{% url 'finder:edit_notification' note.id %}" class="btn-secondary">Edit</a>
            <button onclick="openDeleteModal({{ note.id }})" class="btn-secondary" style="border: transparent;">Delete</button>
        </div>

    </div>
    {% empty %}
        <p style="text-align:center; margin-top:30px;">No notifications submitted.</p>
    {% endfor %}
</div>

<div id="deleteModal" class="modal"
     style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
     background:rgba(0,0,0,0.5); justify-content:center; align-items:center;">

    <div style="background:white; padding:20px; border-radius:8px; width:320px; text-align:center;">
        <h3>Delete Notification?</h3>
        <p>This action cannot be undone.</p>

        <form id="deleteForm" method="POST">
            {% csrf_token %}
            <button type="submit"
                    class="btn-secondary"
                    style="margin-top:10px; border:none;">
                Yes, Delete
            </button>
        </form>

        <button onclick="closeDeleteModal()"
                class="btn-secondary"
                style="margin-top:10px; border:none;">
            Cancel
        </button>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
function openDeleteModal(noteId) {
    const modal = document.getElementById("deleteModal");
    const form = document.getElementById("deleteForm");

    // Use 'finder:delete_notification' instead of just 'delete_notification'
    // Also, use .replace('0', noteId) to be more flexible with trailing slashes
    let url = "{% url 'finder:delete_notification' 0 %}";
    form.action = url.replace('0', noteId); 
    
    modal.style.display = "flex";
}

function closeDeleteModal() {
    document.getElementById("deleteModal").style.display = "none";
}
</script>
{% endblock %}
